<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Geometry Dash - Full Clone</title>
<style>
  body { margin:0; background:#222; font-family:sans-serif; overflow:hidden; }
  canvas { display:block; margin:auto; background:#333; }
  #progress { position:absolute; top:10px; left:10px; color:white; font-size:18px; }
  #level { position:absolute; top:10px; right:10px; color:white; font-size:18px; }
</style>
</head>
<body>
<div id="progress">Progress: 0%</div>
<div id="level">Level 1</div>
<canvas id="game"></canvas>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = 800;
canvas.height = 400;

// ======= GAME VARIABLES =======
let player = { x:50, y:300, size:30, dy:0, gravity:0.8, jump:-15, onGround:true, mode:'cube' };
let obstacles = [];
let portals = [];
let speed = 5;
let score = 0;
let gameOver = false;
let distance = 0;
let levelLength = 4000;

// ======= INPUT =======
document.addEventListener('keydown', e=>{
    if(e.code==='Space'){
        if(player.mode==='cube' && player.onGround){
            player.dy = player.jump;
            player.onGround = false;
        } else if(player.mode==='UFO'){
            player.dy = -7;
        }
    }
});

// ======= LEVEL DESIGN =======
function addObstacle(x, height){
    obstacles.push({x:x, y:canvas.height-height, w:20, h:height});
}

// generate obstacles every ~220 px
for(let i=300;i<levelLength;i+=220){
    addObstacle(i, Math.random()*60+30);
}

// add portals
portals.push({x:levelLength/2, type:'UFO', triggered:false});
portals.push({x:levelLength-100, type:'END', triggered:false});

// ======= GAME LOOP =======
function update(){
    if(gameOver) return;
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // ==== PLAYER PHYSICS ====
    if(player.mode==='cube'){
        player.dy += player.gravity;
        player.y += player.dy;
        if(player.y + player.size > canvas.height){
            player.y = canvas.height - player.size;
            player.dy = 0;
            player.onGround = true;
        }
    } else {
        player.dy += 0.5;
        player.y += player.dy;
        if(player.y<0) player.y=0;
        if(player.y + player.size>canvas.height) player.y=canvas.height-player.size;
    }

    // ==== DRAW PLAYER ====
    ctx.fillStyle = '#4caf50';
    ctx.fillRect(player.x, player.y, player.size, player.size);

    // ==== MOVE AND DRAW OBSTACLES ====
    for(let i=0;i<obstacles.length;i++){
        obstacles[i].x -= speed;
        ctx.fillStyle = '#f44336';
        ctx.fillRect(obstacles[i].x, obstacles[i].y, obstacles[i].w, obstacles[i].h);

        // collision detection
        if(player.x < obstacles[i].x+obstacles[i].w &&
           player.x+player.size>obstacles[i].x &&
           player.y<obstacles[i].y+obstacles[i].h &&
           player.y+player.size>obstacles[i].y){
               gameOver=true;
               alert('Game Over! Score: '+score);
               location.reload();
        }
    }

    // ==== PORTALS ====
    for(let i=0;i<portals.length;i++){
        let p = portals[i];
        if(!p.triggered && player.x + player.size > p.x){
            p.triggered=true;
            if(p.type==='UFO') player.mode='UFO';
            if(p.type==='END'){
                alert('Level Complete! Score: '+score);
                location.reload();
            }
        }
        ctx.beginPath();
        ctx.arc(p.x-player.x+player.x, canvas.height-50, 15,0,Math.PI*2);
        ctx.fillStyle=(p.type==='UFO')?'#00f':'#ff0';
        ctx.fill();
    }

    // ==== PROGRESS BAR ====
    distance += speed;
    let prog = Math.min(100, Math.floor((distance/levelLength)*100));
    document.getElementById('progress').innerText='Progress: '+prog+'%';

    // ==== SCORE ====
    score++;
    ctx.fillStyle='#fff';
    ctx.font='20px Arial';
    ctx.fillText('Score: '+score,10,50);

    requestAnimationFrame(update);
}

update();
</script>
</body>
</html>
